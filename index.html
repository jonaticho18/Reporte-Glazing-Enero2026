<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Glazing / Polarizados Arquitectura (Córdoba) — Dashboard Enero 2026</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{ --c1:#1e40af; --c2:#10b981; --c3:#8b5cf6; --c4:#0ea5e9; --bg:#0b1220; }
    body{background:linear-gradient(135deg,var(--bg),#1f2a44); color:#111;}
    .shell{background:rgba(255,255,255,.96); border-radius:18px; padding:22px; margin:18px; box-shadow:0 18px 50px rgba(0,0,0,.25);}
    .hero{background:linear-gradient(135deg,var(--c1),var(--c3)); color:#fff; border-radius:18px; padding:22px; margin-bottom:16px;}
    .kpi{background:#fff; border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.08); border-left:6px solid var(--c1); height:100%;}
    .kpi .v{font-size:1.65rem; font-weight:800; color:var(--c1);}
    .kpi .l{font-size:.78rem; letter-spacing:.08em; text-transform:uppercase; color:#6b7280;}
    .kpi .s{font-size:.85rem; color:#059669; font-weight:600;}
    .cardx{background:#fff; border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);}
    .note{background:rgba(16,185,129,.10); border:1px solid rgba(16,185,129,.35); border-radius:14px; padding:14px;}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; font-size:.8rem;}
    .pill.ok{background:rgba(16,185,129,.12); color:#047857;}
    .pill.info{background:rgba(14,165,233,.12); color:#0369a1;}
    .muted{color:#6b7280;}
    canvas{max-height:320px;}
    .table thead th{background:var(--c1); color:#fff; border:0;}
    .badgeFmt{background:rgba(139,92,246,.12); color:#5b21b6; border:1px solid rgba(139,92,246,.25);}
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="shell">
      <div class="hero">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
          <div>
            <h1 class="h3 m-0">Glazing / Polarizados de Arquitectura — Córdoba</h1>
            <div class="opacity-75">Meta Ads | Objetivo: Interacción a WhatsApp | Periodo: Enero 2026</div>
          </div>
          <div class="text-end">
            <div class="pill ok">Resultados medidos: conversaciones iniciadas</div>
            <div class="small opacity-75">Montos en ARS</div>
          </div>
        </div>
      </div>

      <div class="note mb-3">
        <strong>Insight clave:</strong> en enero sostuvimos un <strong>bajo costo por mensaje</strong> y obtuvimos resultados con <strong>dos formatos</strong> (Imagen y Video), atendiendo gustos de públicos distintos sin perder calidad del anuncio.
      </div>

      <div class="row g-3 mb-2">
        <div class="col-lg-3">
          <div class="cardx">
            <div class="small muted mb-1">Nivel</div>
            <select id="level" class="form-select">
              <option value="campaign">Campaña</option>
              <option value="adset">Conjunto de anuncios</option>
              <option value="ad">Anuncios</option>
            </select>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="cardx">
            <div class="small muted mb-1">Elemento</div>
            <select id="entity" class="form-select"></select>
            <div class="small muted mt-2">Tip: en “Anuncios” podés comparar Imagen (IMG4) vs Video (Reel V1Nov06).</div>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="cardx">
            <div class="small muted mb-1">Formato</div>
            <select id="format" class="form-select">
              <option value="all">Todos</option>
              <option value="image">Imagen</option>
              <option value="video">Video</option>
            </select>
          </div>
        </div>
      </div>

      <div class="row g-3 my-1">
        <div class="col-6 col-lg-2"><div class="kpi"><div class="l">Mensajes</div><div class="v" id="k_messages">—</div><div class="s">Conversaciones iniciadas</div></div></div>
        <div class="col-6 col-lg-2"><div class="kpi"><div class="l">Gasto total</div><div class="v" id="k_spend">—</div><div class="s">ARS en el periodo</div></div></div>
        <div class="col-6 col-lg-2"><div class="kpi"><div class="l">Costo/Mensaje</div><div class="v" id="k_cpmess">—</div><div class="s">Muy competitivo en Córdoba</div></div></div>
        <div class="col-6 col-lg-2"><div class="kpi"><div class="l">Alcance</div><div class="v" id="k_reach">—</div><div class="s">Usuarios únicos</div></div></div>
        <div class="col-6 col-lg-2"><div class="kpi"><div class="l">Frecuencia</div><div class="v" id="k_freq">—</div><div class="s">Impactos promedio</div></div></div>
        <div class="col-6 col-lg-2"><div class="kpi"><div class="l">CTR</div><div class="v" id="k_ctr">—</div><div class="s">CTR (all)</div></div></div>
      </div>

      <div class="row g-3 mt-2">
        <div class="col-lg-6">
          <div class="cardx">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-semibold">Funnel simple (Alcance → Impresiones → Clicks → Mensajes)</div>
              <span class="pill info">Interacción a WhatsApp</span>
            </div>
            <canvas id="funnel"></canvas>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="cardx">
            <div class="fw-semibold mb-2">Imagen vs Video (Mensajes y Costo/Mensaje)</div>
            <canvas id="formats"></canvas>
          </div>
        </div>
      </div>

      <div class="row g-3 mt-2">
        <div class="col-lg-6">
          <div class="cardx">
            <div class="fw-semibold mb-2">Eficiencia (CPC aproximado y CPM)</div>
            <canvas id="eff"></canvas>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="cardx">
            <div class="fw-semibold mb-2">Tabla (top elementos por Mensajes)</div>
            <div class="table-responsive">
              <table class="table table-sm align-middle mb-0" id="tbl">
                <thead>
                  <tr>
                    <th>Nombre</th><th>Formato</th><th>Mensajes</th><th>Gasto (ARS)</th><th>Costo/Mensaje</th><th>CTR</th><th>Frecuencia</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="small muted mt-2">“Mensajes” = messaging conversation started (Meta).</div>
          </div>
        </div>
      </div>

      <div class="note mt-3">
        <strong>Optimización aplicada:</strong> actualizamos el público con intereses más diversos (análisis previo) y mantuvimos la calidad del anuncio para sostener el costo por resultado.
      </div>
    </div>
  </div>

<script>
/**
  DATA EMBEBIDA
  Corrección aplicada: valores de CAMPAÑA tomados del CSV de campaña actualizado.
**/
const DATA = {
  campaign: [
    {
      name:"ABO | Glazing Leads Campaign | 01-08",
      results:199,
      reach:26649,
      impressions:56554,
      // en el CSV actualizado: Cost per results = 589.79025126, Amount spent (ARS) = 117368.26
      cpr:589.79025126,
      spend:117368.26,
      // Corrección de columnas: en el CSV "CTR (all)" = 1.762917 y "Frequency" = 2.122181
      ctr:1.762917,
      freq:2.122181,
      unique_clicks:413,
      thruplays:1255
    }
  ],
  // Mantengo adsets/ads como estaban antes (pueden no totalizar igual que campaña)
  adset: [
    {
      name:"Broad Construction Renovation WP",
      results:129, reach:16394, impressions:30633,
      cpr:453.913643, spend:58554.862,
      ctr:1.868549, freq:2.115366,
      unique_clicks:5493, thruplays:0
    },
    {
      name:"Broad Construction Renovation WP - reels",
      results:70, reach:14484, impressions:25921,
      cpr:840.191428, spend:57588.13,
      ctr:1.78963, freq:1.78963,
      unique_clicks:0, thruplays:13125
    }
  ],
  ad: [
    { name:"IMG4", format:"image", results:129, reach:16394, impressions:30633, cpr:453.913643, spend:58554.862, ctr:1.868549, freq:2.115366, unique_clicks:5493, thruplays:0 },
    { name:"Reel V1Nov06", format:"video", results:70, reach:14413, impressions:25756, cpr:835.008857, spend:58450.62, ctr:1.786998, freq:1.339494, unique_clicks:0, thruplays:12341 }
  ]
};

function moneyARS(x){
  if (x === null || x === undefined || isNaN(x)) return "—";
  return x.toLocaleString("es-AR",{minimumFractionDigits:0, maximumFractionDigits:0}) + " ARS";
}
function num(x){
  if (x === null || x === undefined || isNaN(x)) return "—";
  return x.toLocaleString("es-AR");
}

const els = {
  level: document.getElementById("level"),
  entity: document.getElementById("entity"),
  format: document.getElementById("format"),
  k_messages: document.getElementById("k_messages"),
  k_spend: document.getElementById("k_spend"),
  k_cpmess: document.getElementById("k_cpmess"),
  k_reach: document.getElementById("k_reach"),
  k_freq: document.getElementById("k_freq"),
  k_ctr: document.getElementById("k_ctr"),
  tblBody: document.querySelector("#tbl tbody")
};

let charts = {};

function getRows(){
  const lvl = els.level.value;
  let rows = DATA[lvl].slice();
  const fmt = els.format.value;
  if (fmt !== "all" && lvl === "ad"){
    rows = rows.filter(r => r.format === fmt);
  }
  return rows;
}

function refreshEntityOptions(){
  const rows = getRows();
  els.entity.innerHTML = "";
  rows.forEach((r,i)=>{
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = r.name;
    els.entity.appendChild(opt);
  });
}

function computeAggregate(rows){
  const sum = (k)=>rows.reduce((a,r)=>a+(+r[k]||0),0);
  const impressions = sum("impressions");
  const spend = sum("spend");
  const results = sum("results");
  const reach = rows.reduce((m,r)=>Math.max(m,(+r.reach||0)),0);

  const ctr = impressions ? rows.reduce((a,r)=>a+((+r.ctr||0) * (+r.impressions||0)),0)/impressions : 0;
  const freq = impressions ? rows.reduce((a,r)=>a+((+r.freq||0) * (+r.impressions||0)),0)/impressions : 0;

  const cpr = results ? spend/results : 0;
  return {results, spend, reach, impressions, ctr, freq, cpr};
}

function setKPIs(agg){
  els.k_messages.textContent = num(agg.results);
  els.k_spend.textContent = moneyARS(agg.spend);
  els.k_cpmess.textContent = moneyARS(agg.cpr);
  els.k_reach.textContent = num(agg.reach);
  els.k_freq.textContent = agg.freq ? agg.freq.toFixed(2) : "—";
  els.k_ctr.textContent = agg.ctr ? agg.ctr.toFixed(2) + "%" : "—";
}

function upsertChart(id, type, data, options){
  if (charts[id]) charts[id].destroy();
  charts[id] = new Chart(document.getElementById(id), {type, data, options});
}

function draw(){
  const rows = getRows();
  refreshEntityOptions();
  const agg = computeAggregate(rows);
  setKPIs(agg);

  const clicks = rows.reduce((a,r)=>a+(+r.unique_clicks||0),0);

  upsertChart("funnel","bar",{
    labels:["Alcance","Impresiones","Link Clicks (únicos)","Mensajes"],
    datasets:[{
      label:"Volumen",
      data:[agg.reach, agg.impressions, clicks, agg.results],
      backgroundColor:["#8b5cf6","#1e40af","#0ea5e9","#10b981"],
      borderRadius:8
    }]
  },{
    plugins:{legend:{display:false}},
    scales:{y:{beginAtZero:true}}
  });

  const ads = DATA.ad;
  const img = ads.find(a=>a.format==="image");
  const vid = ads.find(a=>a.format==="video");
  upsertChart("formats","bar",{
    labels:["Imagen","Video"],
    datasets:[
      {label:"Mensajes", data:[img?.results||0, vid?.results||0], backgroundColor:["#10b981","#8b5cf6"], borderRadius:8, yAxisID:"y"},
      {label:"Costo/Mensaje (ARS)", data:[img?.cpr||0, vid?.cpr||0], backgroundColor:["rgba(30,64,175,.25)","rgba(30,64,175,.25)"], borderColor:["#1e40af","#1e40af"], borderWidth:2, type:"line", yAxisID:"y1", tension:.35}
    ]
  },{
    scales:{
      y:{beginAtZero:true, title:{display:true,text:"Mensajes"}},
      y1:{beginAtZero:true, position:"right", grid:{drawOnChartArea:false}, title:{display:true,text:"ARS"}}
    }
  });

  const cpm = agg.impressions ? (agg.spend / agg.impressions) * 1000 : 0;
  const cpc = clicks ? (agg.spend / clicks) : 0;
  upsertChart("eff","doughnut",{
    labels:["CPM (ARS)","CPC aprox (ARS)","Costo/Mensaje (ARS)"],
    datasets:[{
      data:[cpm,cpc,agg.cpr],
      backgroundColor:["#0ea5e9","#f59e0b","#10b981"],
      borderColor:"#fff",
      borderWidth:3
    }]
  },{
    plugins:{
      tooltip:{callbacks:{label:(ctx)=>`${ctx.label}: ${moneyARS(ctx.parsed)}`}},
      legend:{position:"bottom"}
    }
  });

  els.tblBody.innerHTML = "";
  const tableRows = DATA[els.level.value].slice().map(r=>{
    const format = r.format ? (r.format==="image"?"Imagen":"Video") : "—";
    return {
      name:r.name, format, results:+r.results||0, spend:+r.spend||0, cpr:+r.cpr||0,
      ctr:+r.ctr||0, freq:+r.freq||0
    };
  }).sort((a,b)=>b.results-a.results);

  tableRows.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><span class="badge badgeFmt">${r.name}</span></td>
      <td>${r.format}</td>
      <td class="fw-semibold">${num(r.results)}</td>
      <td>${moneyARS(r.spend)}</td>
      <td class="fw-semibold">${moneyARS(r.cpr)}</td>
      <td>${r.ctr? r.ctr.toFixed(2)+"%":"—"}</td>
      <td>${r.freq? r.freq.toFixed(2):"—"}</td>
    `;
    els.tblBody.appendChild(tr);
  });
}

els.level.addEventListener("change", ()=>{ draw(); });
els.format.addEventListener("change", ()=>{ draw(); });

draw();
</script>
</body>
</html>

